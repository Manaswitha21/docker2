pipeline {
    agent any

    stages {
         stage('Docker Hub Login') {
            steps {
                script {
                    withCredentials([usernamePassword(credentialsId: 'docker-hub-credentials', passwordVariable: 'DOCKERHUB_PASSWORD', usernameVariable: 'DOCKERHUB_USERNAME')]) {
                    sh "docker login -u ${DOCKERHUB_USERNAME} -p ${DOCKERHUB_PASSWORD}"
                }

                }
            }
        }

        stage('Deploy Images') {
            steps {
                script {
                    // Define the Docker image name and tag
                    def imageName1 = 'manaswitha2/dockerrepo2:one'
                    def imageName2 = 'manaswitha2/dockerrepo2:two'
                  

                    // SSH into your EC2 instance and pull/run the Docker image
                    sshagent(credentials: ['ssh-ec2']) {
                        sh "ssh -o StrictHostKeyChecking=no ec2-user@3.88.128.153 'docker pull ${imageName1}'"
                        sh "docker run -d -p 4005:3000 ${imageName1}"
                        sh "ssh -o StrictHostKeyChecking=no ec2-user@3.88.128.153 'sudo docker pull ${imageName2}'"
                        sh "docker run -d -p 4005:5000 ${imageName2}"
                    }
                }
            }
        }

    }

}
